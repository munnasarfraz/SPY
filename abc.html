import os
import re

def regularexpression(filenames, folder_path):
    # Create an empty list to store matching filenames
    matching_files = []

    # List all files in the folder
    available_files = os.listdir(folder_path)
    
    # Iterate through the list of filenames
    for filename in filenames:
        # First, check if the filename exists in the folder (exact match)
        if filename in available_files:
            matching_files.append(filename)  # Add to list if file exists in the folder
        else:
            # If file doesn't exist, check if it matches the regular expression pattern
            base_pattern = re.match(r"([A-Za-z_]+)_\d{8}_\d{4}_(\w+)\.csv", filename)
            
            if not base_pattern:
                print(f"Filename {filename} doesn't match the expected structure.")
                continue  # Skip this file if it doesn't match the expected structure

            # Dynamically create the pattern based on the filename's prefix and postfix
            prefix = base_pattern.group(1)  # FS_ALW_DSM_AS or FS_ALW_DSM_QA
            postfix = base_pattern.group(2)  # e.g., domestic
            
            # Define the dynamic pattern where postfix is flexible, with correct escaping
            pattern = f"{prefix}_\\d{{8}}_\\d{{4}}_{postfix}\\.csv"

            # Compile the regular expression pattern with case insensitivity
            regex = re.compile(pattern, re.IGNORECASE)

            # If the file doesn't exist, but the filename matches the regex pattern, add it to the list
            if regex.match(filename):
                matching_files.append(filename)

    # Return the list of matching files
    return matching_files

# Example usage:
filenames = ["FS_ALW_DSM_AS_20250414_1000_domestic.csv", "FS_ALW_DSM_AQ_20250314_1000_domestic.csv"]
folder_path = "C:\\Users\\Admin\\Desktop\\New Int\\source"  # Example folder path

matching_files = regularexpression(filenames, folder_path)
print(f"Matched files: {matching_files}")
